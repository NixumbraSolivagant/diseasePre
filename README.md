# 第二问：不同疾病预测模型的构建

## 题目理解

**题目要求：**
- 分别选取合适的特征指标，建立中风、心脏病和肝硬化三种疾病患病概率的预测模型
- 进行模型准确性的检验、灵敏度分析和模型改进

## 解决方案：分而治之的集成学习方案

### 核心思想

采用"专科医生会诊 + 总分析师综合研判"的分层架构：

1. **专科医生模型（分而治之）**：每个疾病由专门的专家模型处理
2. **总分析师元模型（结果融合）**：综合各专家意见和基本信息，给出最终预测

### 技术架构

#### 第一步：专科医生会诊（分而治之）

**中风专家**：专门处理 stroke.csv 数据
- 特征：年龄、性别、高血压、心脏病、血糖、BMI等
- 输出：中风风险概率 P_s

**心脏病专家**：专门处理 heart.csv 数据  
- 特征：年龄、性别、胸痛类型、血压、胆固醇、心电图等
- 输出：心脏病风险概率 P_h

**肝硬化专家**：专门处理 cirrhosis.csv 数据
- 特征：年龄、性别、胆红素、白蛋白、凝血酶原时间等
- 输出：肝硬化风险概率 P_c

#### 第二步：总分析师综合研判（结果融合）

**元模型输入**：[P_s, P_h, P_c, 年龄, 性别]
**元模型输出**：[最终P_s, 最终P_h, 最终P_c]

### 模型选择与评估

#### 专科医生模型候选
- **XGBoost**：梯度提升树，处理非线性关系能力强
- **LightGBM**：轻量级梯度提升，训练速度快
- **随机森林**：集成学习，抗过拟合
- **SVM**：支持向量机，适合小样本

#### 元模型
- **XGBoost**：综合各专家意见，学习特征间交互

#### 评估指标
- **准确率 (Accuracy)**：整体预测正确率
- **精确率 (Precision)**：预测为正例中实际为正例的比例
- **召回率 (Recall)**：实际正例中被正确预测的比例
- **F1值**：精确率和召回率的调和平均
- **AUC-ROC**：ROC曲线下面积，评估分类性能

### 灵敏度分析

#### 第一层：特征扰动分析
- 对核心特征施加±20%的相对扰动
- 计算预测概率变化率
- 识别对模型最敏感的特征

#### 第二层：模型稳定性检验
- Bootstrap重采样（1000次）
- 计算预测概率的标准差
- 评估模型对数据噪声的鲁棒性

### 模型改进

#### 可解释性增强
- **SHAP值分析**：量化特征对预测的贡献
- **特征重要性排序**：识别关键风险因子

#### 性能优化
- **超参数调优**：网格搜索最优参数
- **特征选择**：去除冗余特征
- **数据增强**：处理类别不平衡

## 文件结构

```
第二问/
├── disease_prediction.py    # 主程序
├── requirements.txt         # 依赖包
├── README.md               # 说明文档
└── output/                 # 输出结果
    ├── csv/第二问/         # CSV报告
    └── plt/第二问/         # 可视化图表
```

## 运行方法

1. 安装依赖：
```bash
pip install -r requirements.txt
```

2. 运行分析：
```bash
python disease_prediction.py
```

## 输出结果

### CSV报告
- `model_performance_report.csv`：各模型性能对比
- `*_feature_importance.csv`：特征重要性排序

### 可视化图表
- `model_comparison.png`：模型性能对比图
- `feature_importance.png`：特征重要性图
- `roc_curves.png`：ROC曲线对比
- `sensitivity_analysis.png`：灵敏度分析结果

## 数学原理

### 1. 集成学习
专科医生模型采用Bagging和Boosting技术：
- **Bagging**：并行训练多个基学习器，减少方差
- **Boosting**：串行训练，每个模型关注前一个模型的错误

### 2. 元学习
总分析师模型学习专科医生模型的输出模式：
- 输入：专科医生预测概率 + 基本信息
- 输出：校准后的最终概率
- 目标：最小化预测误差

### 3. 灵敏度分析
- **特征扰动**：∂P/∂x_i ≈ (P(x_i + Δx_i) - P(x_i)) / Δx_i
- **Bootstrap稳定性**：σ_P = √(Σ(P_i - P̄)² / (n-1))

### 4. SHAP值
- 基于博弈论的模型解释方法
- SHAP_i = Σ_{S⊆N\{i}} |S|!(|N|-|S|-1)!/|N|! [f(S∪{i}) - f(S)]

## 优势分析

1. **专业化**：每个模型专注于特定疾病，充分利用领域知识
2. **鲁棒性**：集成学习减少过拟合，提高泛化能力
3. **可解释性**：SHAP值提供特征贡献的量化解释
4. **可扩展性**：易于添加新的疾病类型或专家模型
5. **实用性**：符合医学诊断的实际工作流程 